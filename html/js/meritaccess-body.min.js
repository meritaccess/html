$(document).ready(function() {
	var currentPage = 0;
	var table = $('#data-table').DataTable({
		"dom": '<"#data-table-header"f>rt<"#data-table-footer"lip>',
		"processing": true,
		"language": {
			"processing": 'Loading...',
			"search": 'Filter',
			"paginate": {
				"first": '&laquo;',
				"previous": '&lsaquo;',
				"next": '&rsaquo;',
				"last": '&raquo;'
			}
		},
		"order": [],
		"pageLength": 50,
		"pagingType": 'full',
		"fnDrawCallback": function(oSettings) {
			var totalPages = this.api().page.info().pages;
			if(totalPages == 1) {
				$('.dt-length').addClass('hidden-area');
				$('.dt-paging').addClass('hidden-area');
			} else {
				$('.dt-length').removeClass('hidden-area');
				$('.dt-paging').removeClass('hidden-area');
			}
		}
	});
	$.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
		return !$(table.row(dataIndex).node()).hasClass('tr-deleted');
	});
	var toggleButton = $('<button type="button">Show blocked</button>').insertAfter('#dt-search-0').on('click', function() {
		var showDeleted = $(this).hasClass('active');
		if(showDeleted) {
			$(this).removeClass('active').text('Hide blocked');
		} else {
			$(this).addClass('active').text('Show blocked');
		}
		currentPage = table.page();
		$.fn.dataTable.ext.search.pop();
		if(!showDeleted) {
			$.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
				return !$(table.row(dataIndex).node()).hasClass('tr-deleted');
			});
		}
		table.draw();
	});
	toggleButton.trigger('click');
	table.on('init.dt', function() {
		var state = table.state.loaded();
		if(state) {
			table.page(state.start / state.length).draw(false);
		}
	});
});